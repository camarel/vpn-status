#!/bin/sh
echo "Content-type: text/html"
echo ""

command="${QUERY_STRING%%=*}"
parameter="${QUERY_STRING#*=}"

# sanitize the input
command=${command//[^a-zA-Z0-9]/}
parameter=${parameter//[^a-zA-Z0-9\.]/}

if [ -z "$parameter" ] || [ "$parameter" = "$command" ]; then
  exit 0
else
  if [ "$command" = "ping" ]; then
    echo "$(ping -c 1 "$parameter" | grep time)"
  fi;

  if [ "$command" = "trace" ]; then
    echo "<!DOCTYPE html>"
    echo "<html>"
    echo "<body>"
    echo "<pre style='color: white;' id='traceResponse'>$(traceroute -m 5 -q 1 -w 1 "$parameter")</pre>"
    echo "</body></html>"
  fi;
fi
